From 0f06370e23e6b0856b66c153760351eec60f4e1f Mon Sep 17 00:00:00 2001
From: mochangming <mochangming@xiaomi.com>
Date: Tue, 21 Aug 2012 16:24:12 +0800
Subject: [PATCH] support the shutdown alarm clock

---
 .../android/deskclock/AlarmInitReceiver$1.smali    |    5 -
 DeskClock/smali/com/android/deskclock/Alarms.smali |  211 ++++++++++----------
 2 files changed, 109 insertions(+), 107 deletions(-)

--- a/DeskClock/smali/com/android/deskclock/AlarmInitReceiver$1.smali
+++ b/DeskClock/smali/com/android/deskclock/AlarmInitReceiver$1.smali
@@ -80,10 +80,6 @@
 
     invoke-virtual {v0}, Lmiui/net/FirewallManager;->setAlarmBootCompleted()V
 
-    sget-boolean v0, Lmiui/os/Build;->IS_MIONE:Z
-
-    if-eqz v0, :cond_3
-
     invoke-static {}, Ljava/lang/System;->currentTimeMillis()J
 
     move-result-wide v0
--- a/DeskClock/smali/com/android/deskclock/Alarms.smali
+++ b/DeskClock/smali/com/android/deskclock/Alarms.smali
@@ -802,6 +802,10 @@
     .local v1, sender:Landroid/app/PendingIntent;
     invoke-virtual {v0, v1}, Landroid/app/AlarmManager;->cancel(Landroid/app/PendingIntent;)V
 
+    const/4 v2, 0x4
+
+    invoke-virtual {v0, v2}, Landroid/app/AlarmManager;->clearAlarm(I)V
+
     invoke-static {p0, v4}, Lcom/android/deskclock/Alarms;->setStatusBarIcon(Landroid/content/Context;Z)V
 
     const-string v2, ""
@@ -1134,7 +1138,9 @@
     move-result-object v4
 
     .local v4, sender:Landroid/app/PendingIntent;
-    invoke-virtual {v0, v8, p2, p3, v4}, Landroid/app/AlarmManager;->set(IJLandroid/app/PendingIntent;)V
+    const/4 v6, 0x4
+
+    invoke-virtual {v0, v6, p2, p3, v4}, Landroid/app/AlarmManager;->set(IJLandroid/app/PendingIntent;)V
 
     const/4 v6, 0x1
 
-- 
1.7.1

